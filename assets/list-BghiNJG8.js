import{O as y,h as n,q as f,p as k,s as b,c as _}from"./h-CGQjB-EJ.js";import{D as M,L as S,G as U}from"./groupForm-YWdzI5hy.js";import{T,a as L}from"./taskDetailViewModel-Cbkn59O-.js";class C extends y{constructor(e,s){super(),this.factory=e,this.repository=s}create(e,s=""){const o=this.factory.create(e,s),a=this.repository.save(o);return this.notify(o),a}}const c=(t,e)=>{if(!t)throw new Error(`Elemento ${e} não encontrado`);return t},V=(t=document)=>({get task(){return c(t.getElementById("task"),"Input da Tarefa")},get main_content(){return c(t.querySelector(".main-content"),"Conteúdo principal")},get main_completed_tasks(){return c(t.querySelector(".main-drop-down-task"),"Seção principal de tarefas concluídas")},get completed_tasks(){return c(t.querySelector(".drop-down-task"),"Lista de tarefas concluídas")},get main_tasks(){return c(t.querySelector(".main-tasks"),"Lista de tarefas ativas")},get add_task(){return c(t.querySelector(".add-task"),"Botão de adicionar tarefa")},get main_form(){return c(t.querySelector(".main-form"),"Formulário principal")},get send_task(){return c(t.getElementById("send-task"),"Botão de envio da tarefa")},get button_completed_tasks(){return c(t.getElementById("button-completed-tasks"),"Botão de exibir tarefas concluídas")},get task_checkbox(){return t.querySelectorAll(".task-checkbox")},get tasks(){return t.querySelectorAll(".tasks")},get settings(){return c(t.getElementById("settings"),"Botão de configurações")},get settings_drop_down(){return c(t.querySelector(".settings-drop-down"),"Menu de configurações")}}),l=V();class D{static showDropDown(){l.settings_drop_down.classList.toggle("is-active")}}class q{static showForm(){l.add_task.style.display="none",l.main_form.style.display="flex"}static hideForm(){l.add_task.style.display="flex",l.main_form.style.display="none"}}class B{constructor(e,s){this.listViewModel=e,this.detailViewModel=s}showCompletedTasks(){l.completed_tasks.style.display==="none"||l.completed_tasks.style.display===""?(l.completed_tasks.style.display="flex",l.button_completed_tasks.innerHTML='<span class="fa-solid fa-chevron-down"></span> Concluídas'):(l.completed_tasks.style.display="none",l.button_completed_tasks.innerHTML='<span class="fa-solid fa-chevron-right"></span> Concluídas')}renderTask(e){l.main_tasks.innerHTML="",l.completed_tasks.innerHTML="",this.listViewModel.load().forEach(s=>{this.createTemplateTask(s,s.completed,e)})}createTemplateTask(e,s=!1,o){const a=n(T,{task:e,key:o}),i=a.querySelector(".task-checkbox");s?l.completed_tasks.appendChild(a):l.main_tasks.appendChild(a),i.addEventListener("click",()=>{this.detailViewModel.completedTask(e),e.completed&&new Audio("./completedTaskSound.mp3").play(),this.renderTask(o)})}}function I(){return n("div",{className:"settings-drop-down"},n("p",{id:"changeThemeButton"},n("span",{className:"fa-solid fa-palette","aria-label":"imagem ilustrativa de uma palheta artística"}),"Alterar tema"))}function x({title:t,dropDown:e}){return n("header",{className:"main-header"},n("a",{className:"fa-solid fa-arrow-left",href:"index.html"}),n("h1",null,t),n("div",{id:"settings",className:"fa-solid fa-ellipsis-vertical"}),n("div",{className:"main-settings"}),e)}function N(){return n("section",{className:"add-task"},n("button",null,"+"))}function F(){return n("form",{className:"main-form"},n("div",{className:"content-form"},n("input",{type:"text",placeholder:"Sua tarefa",id:"task"}),n("button",{id:"send-task",type:"submit"},n("span",{className:"fa-solid fa-arrow-up","aria-label":"imagem ilustrativa de inclusão de uma tarefa"}))))}function A(){return n("div",{className:"settings-drop-down"},n("div",{id:"changeThemeButton",className:"drop-down-content"},n("span",{className:"fa-solid fa-palette","aria-label":"Botão para alterar o tema da lista atual"}),n("strong",null,"Alterar tema")),n("div",{id:"editGroup",className:"drop-down-content"},n("span",{className:"fa-solid fa-pencil","aria-label":"Botão para editar as informações do grupo atual"}),n("strong",null,"Renomear lista")),n("div",{id:"deleteGroup",className:"drop-down-content"},n("span",{className:"fa-solid fa-trash","aria-label":"Botão para excluir a lista atual"}),n("strong",null,"Excluir lista")),n("div",{id:"sendCopy",className:"drop-down-content"},n("span",{className:"fa-solid fa-copy","aria-label":"Botão para enviar uma cópia da lista de tarefas atual"}),n("strong",null,"Enviar uma cópia")))}class R{constructor(e,{viewModels:s={},uis:o={},components:a={},config:i}){this.viewModels=s,this.uis=o,this.components=a,this.config=i,this.color=this.viewModels.groupVM.find(e)?.color}bindUiEvents(){this.uis.UiElements.add_task.addEventListener("click",()=>{this.uis.UiElements.settings.setAttribute("disabled","true"),this.uis.FormUi.showForm()}),this.uis.UiElements.button_completed_tasks.addEventListener("click",()=>{this.uis.taskUI.showCompletedTasks(),this.uis.linesRenderer()}),this.uis.UiElements.settings.addEventListener("click",()=>{this.uis.HeaderUi.showDropDown()});const e=document.querySelector(".todo__form--container");document.getElementById("cancel")?.addEventListener("click",()=>{e.style.display="none"}),window.addEventListener("scroll",()=>{const s=document.querySelector(".main-header");window.scrollY>50?s?.classList.add("is-shrink"):s?.classList.remove("is-shrink")}),document.getElementById("changeThemeButton")?.addEventListener("click",()=>{this.uis.UiElements.main_content.classList.toggle("light-theme")}),document.getElementById("editGroup")?.addEventListener("click",()=>{e.style.display="flex"}),document.querySelectorAll(".todo__form--color-content").forEach(s=>{s.addEventListener("click",o=>{const a=o.target.dataset.color;document.documentElement.style.setProperty("--main-color",a),this.color=a})})}bindViewModelsEvents(e){document.querySelector(".todo__form--container"),this.viewModels.groupVM.subscribe(o=>{location.href=this.config.get("routers").list.concat(`?key=${o.name}`)}),document.getElementById("create")?.addEventListener("click",()=>{this.viewModels.groupVM.edit(this.viewModels.groupVM.find(e),{id:document.getElementById("group").value,name:document.getElementById("group").value,color:this.color,icon:Array.from(document.querySelector(".icon").classList).slice(0,2).join(" ")})}),this.viewModels.taskCreateVM.subscribe(()=>{this.uis.FormUi.hideForm(),this.uis.taskUI.renderTask(e)}),this.uis.UiElements.send_task.addEventListener("click",o=>{this.uis.UiElements.settings.setAttribute("disabled","false");const a=this.uis.UiElements.task.value.trim();this.viewModels.taskCreateVM.create(a)}),document.getElementById("deleteGroup")?.addEventListener("click",()=>{this.viewModels.groupVM.remove(e),location.href=this.config.get("routers").home});async function s(o){if(navigator.share)try{await navigator.share({title:"Lista de tarefas",text:o}),console.log("Compartilhamento feito com sucesso!")}catch(a){console.error("Erro ao compartilhar:",a)}else alert("Seu navegador não suporta compartilhamento nativo. Por isso, copiamos a lista de tarefa para Área de transferência do seu teclado, basta apenas colar onde quiser.")}document.getElementById("sendCopy").addEventListener("click",async()=>{let o=`${e}
`;const a=[],i=[];this.viewModels.taskListVM.load().forEach(d=>{d.completed?i.push(d):a.push(d)}),a.forEach(d=>{o+=`○ ${d.name}
`}),o+=`
 Concluidas:
`,i.forEach(d=>{o+=`    ● ${d.name}
`}),navigator.clipboard?navigator.clipboard.writeText(o):copyToClipboardFallback(o),s(o)})}render(e){this.uis.taskUI.renderTask(e),this.uis.theme(e,this.color),this.uis.UiElements.main_content.prepend(n(this.components.groupForm,{method:"puta"}));let s=n(this.components.groupDropDown,null);this.config.get("mainGroups").includes(e)&&(s=n(this.components.DropDown,null));const o=n(this.components.Header,{title:e,dropDown:s});this.uis.UiElements.main_content.appendChild(o),this.uis.UiElements.main_content.appendChild(this.components.ButtonAddTask()),this.uis.UiElements.main_content.appendChild(this.components.Form()),document.querySelector(".icon")&&(document.querySelector(".icon").classList=`${this.viewModels.groupVM.find(e)?.icon} icon`),this.uis.linesRenderer(),this.bindViewModelsEvents(e),this.bindUiEvents()}}class H extends y{constructor(e,s,o){super(),this.repository=e,this.groupRepository=s,this.service=o}find(e){return this.repository.find(e)}remove(e){this.unsubscribeAll();const s=this.repository.find(e);this.repository.remove(s),this.groupRepository.clear(e),this.notify({removed:e})}edit(e,s={}){const o=s.id&&s.id!==e.id,a=s.name&&s.name!==e.name;let i;if(o||a){const d=e.name,m=s.name||e.name,E=JSON.parse(localStorage.getItem(d))||[];d!==m&&(localStorage.setItem(m,JSON.stringify(E)),localStorage.removeItem(d)),this.repository.remove(e),this.groupRepository.clear(e.id),i=this.service.edit(e,s),this.repository.save(i),this.groupRepository.save(i)}else i=this.service.edit(e,s),this.groupRepository.edit(i),this.repository.edit(i);return this.notify(i),i}}const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));function G(t,e=0){return(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase()}let p;const $=new Uint8Array(16);function P(){if(!p){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");p=crypto.getRandomValues.bind(crypto)}return p($)}const O=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),g={randomUUID:O};function j(t,e,s){if(g.randomUUID&&!t)return g.randomUUID();t=t||{};const o=t.random??t.rng?.()??P();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,G(o)}class J{constructor(e,s,o,a,i,d,m){this.id=e,this.name=s,this.description=o,this.create_date=a,this.completed=i,this.date=d,this.file=m}}class K{static create(e,s=""){return new J(j(),e.trim(),s.trim(),M.DateFormatBrazilian(),!1,null,null)}}function z(){const t=document.querySelector(".lines");let e=0;window.getComputedStyle(document.querySelector(".drop-down-task")).display==="flex"&&(e=document.querySelector(".drop-down-task").querySelectorAll("ol").length),t.innerHTML="";let s=9-(document.querySelector(".main-tasks").querySelectorAll("ol").length+e);for(let o=0;o<s;o++)t.appendChild(n("hr",null))}function Q(t,e){const o={Importante:"pink-theme","Meu Dia":"green-theme"}[t];o&&document.querySelector(".main-content").classList.add(o),e&&document.documentElement.style.setProperty("--main-color",e)}const h=f.getQueryParams("key"),u=k(h),Y=k("group"),w=new S(u),v=new L(u,f),W=new C(K,u),X=new H(Y,u,b),Z=new B(w,v),ee=new R(h,{viewModels:{groupVM:X,taskCreateVM:W,taskListVM:w,taskDetailVM:v},uis:{taskUI:Z,UiElements:l,FormUi:q,HeaderUi:D,linesRenderer:z,theme:Q},components:{Header:x,ButtonAddTask:N,Form:F,DropDown:I,groupDropDown:A,groupForm:U},config:_});ee.render(h);
